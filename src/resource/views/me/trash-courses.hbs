<div class="mt-4">
    <h3>KHÓA HỌC ĐÃ XÓA</h3>
    <a href="/me/stored/courses">Khóa học của tôi</a>
    <table class="table mt-4">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Tên</th>
                <th scope="col">Trình độ</th>
                <th scope="col" colspan="2">Thời gian xóa</th>
            </tr>
        </thead>
        <tbody>
            {{#each courses}}
                <tr>
                    <th scope="row">{{sum @index 1}}</th>
                    <td>{{this.name}}</td>
                    <td>{{this.level}}</td>
                    <td>{{this.deletedAt}}</td>
                    <td>
                        <a href="" class="btn btn-link btn-restore" data-id="{{this._id}}">Khôi phục</a>
                        <a href="" class="btn btn-link" data-id="{{this._id}}" data-toggle="modal" data-target="#delete-course-modal">Xóa vĩnh viễn</a>
                    </td>
                </tr>
            {{else}}
                <tr>
                    <td colspan="5" class="text-center">
                       Trống. <a href="/me/stored/courses">Về khóa học của tôi</a>
                    </td>
                </tr>
            {{/each}}
        </tbody>
    </table>                                
</div>

<!-- Confirm Delete -->
<div class="modal fade" id="delete-course-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Xóa khóa học</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Hành động này sẽ không thể khôi phục.Bạn muốn xóa khóa học này?
      </div>
      <div class="modal-footer">
        <button  id="btn-delete-course" type="button" class="btn btn-danger">Xóa</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
      </div>
    </div>
  </div>
</div>

<!--HIDDEN FORM -->
<form method="POST" name="delete-form"></form>
<form method="POST" name="restore-form"></form>
<script>
    /* 
    DOMContentLoaded => có tác dụng là khi DOM load content thì sẽ load đoạn script có chứ mã
    => DOMContentLoaded tiếp đoạn callback function trong này
    */
    document.addEventListener("DOMContentLoaded",function(){
        var courseId;
        /**
        document.forms là thuộc tính js có thể nhận biết và tự gọi được form
        */
        var deleteForm = document.forms["delete-form"]; 
        var restoreForm = document.forms["restore-form"]; 

        $('#delete-course-modal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
             courseId = button.data('id');
        });

        var btnDeleteCourseId = document.getElementById("btn-delete-course");
        var btnRestore = $('.btn-restore');
        btnDeleteCourseId.onclick = function(){
            deleteForm.action = '/courses/' + courseId + '/force?_method=DELETE';
            deleteForm.submit();
        }
        // sự khác biệt giữa jQuery vs JavaScript thuần:
        /**
        nếu dùng js thuần trong trường hợp này thì phải xác định đúng hành động của element nào đang thực thi
        nhưng jQuery có attribute cho phép tự động xác định đúng element đang thực thi.
        ==> trong jQuery có attribute nhận luôn sự kiện và attribute của chính nó
        */
        btnRestore.click(function(event){
            event.preventDefault();
            var id = $(this).data('id');
            restoreForm.action = '/courses/' + id + '/restore?_method=PATCH';
            restoreForm.submit();
        });
    })
    
</script>